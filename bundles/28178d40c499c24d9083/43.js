(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1696:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return K}));var o=n(18),r=n.n(o),c=n(27),a=n.n(c),l=n(0),i=n.n(l),s=n(8),u=n(14),d=n(31),f=n(639),m=n(1413),b=n(431),p=n(1402),g=n(1414);var h=n(1537),v=n(12),O=n.n(v);var C=n(1480);var j=n(180),T=n(22),x=n(271);function R(e,t){var n;const[o,r]=Object(l.useState)(null);return{suggestion:null!==(n=null==o?void 0:o.mappedSuggestion)&&void 0!==n?n:null,handleCommand:e=>function(e,t,n,o){var r;if(null===t)return;const{node:c}=t,a=`${e} `;c.textContent=a,null===(r=document.getSelection())||void 0===r||r.setBaseAndExtent(c,a.length,c,a.length),o(a),n(null)}(e,o,r,t),handleMention:(e,n,c)=>S(e,n,c,o,r,t),handleAtRoomMention:e=>S("#","@room",e,o,r,t),onSelect:()=>function(e,t){var n;const o=document.getSelection();if(null===e.current||null===o||!o.isCollapsed||"#text"!==(null===(n=o.anchorNode)||void 0===n?void 0:n.nodeName))return void t(null);const{anchorNode:r,anchorOffset:c}=o;if(null===r.textContent)return void t(null);const a=document.createNodeIterator(e.current,NodeFilter.SHOW_TEXT).nextNode(),l=r===a,i=function(e,t,n){if(t<0||t>e.length)return null;let o=t,r=t;for(;E(e,o);)o--;for(;M(e,r);)r++;const c=e.slice(o,r),a=function(e){const t=e.charAt(0),n=e.slice(1);switch(t){case"/":return{keyChar:t,text:n,type:"command"};case"#":case"@":return{keyChar:t,text:n,type:"mention"};default:return null}}(c);if(null===a||"command"===a.type&&(!n||0!==o||r!==e.length))return null;return{mappedSuggestion:a,startOffset:o,endOffset:o+c.length}}(r.textContent,c,l);if(null===i)return void t(null);t({mappedSuggestion:i.mappedSuggestion,node:r,startOffset:i.startOffset,endOffset:i.endOffset})}(e,r)}}function S(e,t,n,o,r,c){var a,l,i,s;if(null===o)return;const{node:u}=o,d=document.createElement("a"),f=document.createTextNode(t);d.setAttribute("href",e),d.setAttribute("contenteditable","false");for(const[e,t]of n.entries())d.setAttribute(e,t);d.appendChild(f);const m=document.createTextNode((null===(a=u.textContent)||void 0===a?void 0:a.slice(0,o.startOffset))||"â€‹"),b=document.createTextNode(` ${null!==(l=null===(i=u.textContent)||void 0===i?void 0:i.slice(o.endOffset))&&void 0!==l?l:""}`),p=u.parentNode;Object(x.a)(p)&&(p.insertBefore(m,u),p.insertBefore(d,u),p.insertBefore(b,u),p.removeChild(u)),null===(s=document.getSelection())||void 0===s||s.setBaseAndExtent(b,1,b,1),c(),r(null)}function E(e,t){return!(t<=0)&&!/\s/.test(e[t-1])}function M(e,t){return!(t>=e.length)&&!/\s/.test(e[t])}var y=n(26);function k(e){return e.replace(/<div><br><\/div>/g,"\n").replace(/<div>/g,"\n").replace(/<\/div>/g,"")}function N(e,t,n,o){const r=Object(d.c)(),c=Object(y.b)(),a=Object(l.useRef)(null),i=Object(l.useRef)(null),[s,u]=Object(l.useState)(e),f=Object(l.useCallback)((()=>{a.current&&(a.current.innerHTML=""),null==n||n()}),[a,n]),b=Object(l.useCallback)((e=>{if(Object(x.b)(e))u(e),null==t||t(e);else if(Object(x.a)(a)&&Object(x.a)(a.current)){const e=k(a.current.innerHTML);u(e),null==t||t(e)}}),[t,a]),{suggestion:p,onSelect:g,handleCommand:h,handleMention:v,handleAtRoomMention:O}=R(a,b),C=!Object(j.b)("MessageComposerInput.ctrlEnterToSend"),S=Object(l.useCallback)((e=>{if(e.target instanceof HTMLDivElement){const t=C?e.target.innerHTML:k(e.target.innerHTML);b(t)}}),[b,C]),E=Object(l.useCallback)((e=>{const{nativeEvent:t}=e;let n=!1;if(Object(m.d)(t)){const e=t instanceof ClipboardEvent?t.clipboardData:t.dataTransfer;n=Object(m.b)(t,e,r,c,o)}n?e.preventDefault():S(e)}),[o,c,S,r]),M=Object(l.useCallback)((e=>{if(!Object(m.c)(i,e)&&e.key===T.b.ENTER){const t=T.a?e.metaKey:e.ctrlKey;C&&!e.shiftKey&&(e.preventDefault(),e.stopPropagation(),f()),!C&&t&&(e.preventDefault(),e.stopPropagation(),f())}}),[i,C,f]);return{ref:a,autocompleteRef:i,onBeforeInput:E,onInput:S,onPaste:E,onKeyDown:M,content:s,setContent:b,suggestion:p,onSelect:g,handleCommand:h,handleMention:v,handleAtRoomMention:O}}var w=n(1479),A=n(1541),P=n(1546);function I(e){let{className:t,disabled:n=!1,onSend:o,onChange:r,children:c,placeholder:a,initialContent:s,leftComponent:u,rightComponent:d,eventRelation:f}=e;const{ref:m,autocompleteRef:b,onBeforeInput:p,onInput:h,onPaste:v,onKeyDown:j,content:T,setContent:x,suggestion:R,onSelect:S,handleCommand:E,handleMention:M,handleAtRoomMention:y}=N(s,r,o,f),k=function(e,t){return Object(l.useMemo)((()=>({clear:()=>{e.current&&(e.current.innerHTML="")},insertText:n=>{const o=document.getSelection();if(e.current&&o){const r=e.current.innerHTML,{anchorOffset:c,focusOffset:a}=o;e.current.innerHTML=`${r.slice(0,c)}${n}${r.slice(a)}`,Object(g.d)({anchorNode:e.current.firstChild,anchorOffset:c+n.length,focusNode:e.current.firstChild,focusOffset:a+n.length,isForward:!0}),t(e.current.innerHTML)}}})),[e,t])}(m,x);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;Object(l.useEffect)((()=>{t.current&&(t.current.innerText=e)}),[t,e])}(s,m),Object(w.a)(n,m);const{isFocused:I,onFocus:F}=Object(C.a)(),H=!T&&a||void 0;return i.a.createElement("div",{"data-testid":"PlainTextComposer",className:O()(t,{[`${t}-focused`]:I}),onFocus:F,onBlur:F,onBeforeInput:p,onInput:h,onPaste:v,onKeyDown:j,onSelect:S},i.a.createElement(P.a,{ref:b,suggestion:R,handleMention:M,handleCommand:E,handleAtRoomMention:y}),i.a.createElement(A.a,{ref:m,disabled:n,leftComponent:u,rightComponent:d,placeholder:H}),null==c?void 0:c(m,k))}var F=n(527),H=n(1481);function B(e){let{menuPosition:t}=e;const n=Object(d.c)();return i.a.createElement(H.a,{menuPosition:t,addEmoji:e=>(s.a.dispatch({action:u.a.ComposerInsert,text:e,timelineRenderingType:n.timelineRenderingType}),!0)})}const L=["isRichTextEnabled","e2eStatus","menuPosition"],D=Object(l.forwardRef)((function(e,t){let{disabled:n=!1,composerFunctions:o}=e;return function(e,t,n){const o=Object(d.c)(),r=Object(p.c)(),c=Object(l.useRef)(null),a=Object(l.useCallback)((a=>{var l;if(e||null==t||!t.current)return;const i=null!==(l=a.context)&&void 0!==l?l:d.a.Room;switch(a.action){case"reply_to_event":case u.a.FocusAComposer:case u.a.FocusSendMessageComposer:Object(m.a)(t,i,o,c);break;case u.a.ClearAndFocusSendMessageComposer:if(a.timelineRenderingType!==o.timelineRenderingType)break;n.clear(),Object(m.a)(t,i,o,c);break;case u.a.ComposerInsert:if(a.timelineRenderingType!==o.timelineRenderingType)break;if(a.composerType!==b.a.Send)break;a.userId||a.event||a.text&&Object(g.d)(r.selection).then((()=>n.insertText(a.text)))}}),[e,t,o,n,r]);Object(f.a)(s.a,a)}(n,t,o),null}));function K(e){let{isRichTextEnabled:t,e2eStatus:n,menuPosition:o}=e,c=a()(e,L);const s=t?h.a:I,u=Object(l.useRef)(Object(p.b)({eventRelation:c.eventRelation}));return i.a.createElement(p.a.Provider,{value:u.current},i.a.createElement(s,r()({className:"mx_SendWysiwygComposer",leftComponent:n&&i.a.createElement(F.b,{status:n}),rightComponent:i.a.createElement(B,{menuPosition:o})},c),((e,t)=>i.a.createElement(D,{disabled:c.disabled,ref:e,composerFunctions:t}))))}}}]);
//# sourceMappingURL=43.js.map